<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://clearsky.dev/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>The math of love</title></head><body><header id=banner><h2><a href=https://clearsky.dev/>ClearSky</a></h2><nav><ul></ul></nav></header><main id=content><article><header id=post-header><h1>The math of love</h1><div><time>August 29, 2017</time></div></header><p>A friend of mine is getting married soon, and we wanted to do something creative as a present. We wanted to create something involving a small color screen showing motiviational marriage-related quotes. I thought it would be fun to include some animated graphics. What graphics do you include in a wedding-gift? Hearts ofcourse! I wanted to create an animation of a black screen with a red heart that grows until it fills the whole screen.</p><p>First things first, let’s talk hardware. I decided to go with an arduino uno because it is cheap (That is, <a href=https://a.aliexpress.com/_m07TFW4>these chinese clones</a> are) and simple. For the screen i went with this:</p><p><figure><a href=/blog/math-of-love/cat.jpg><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/cat_hu358d630d36e326d29887d10c79e2ac60_269034_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/cat_hu358d630d36e326d29887d10c79e2ac60_269034_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/cat_hu358d630d36e326d29887d10c79e2ac60_269034_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/cat_hu358d630d36e326d29887d10c79e2ac60_269034_1500x0_resize_q75_h2_box.webp><img alt="Cat pictures are the primary advised use case for this product" title="Cat pictures are the primary advised use case for this product" src=cat.jpg class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>The screen is a bit pricey, but nice and small, it has a backlight, 128x128 pixels and 65k colors. It comes with a micro-sd reader and connects through SPI to the arduino. There is an arduino library available for this screen, and adafruit has a <a href=https://learn.adafruit.com/1-8-tft-display/overview>great tutorial on how to use it</a></p><p>So how do we show hearts on this bad boy? Well my first idea was to use bitmaps. The arduino library provides a nice example that loads a bitmap from the SD-card and shows it. However, if you look at the code you see that it is processing the bitmap pixel by pixel. That’s a lot of work for our little arduino! It took about a second to load a fullscreen bitmap. Way too slow for any animations.
So what we are left with is drawing hearts the old-fashioned way: by using the drawing functions provided by the library. To create the animation, i wanted to have a function that could draw a heart on any location, size and color.
So which primitive shapes make up a heart? Well for the top you need two overlapping circles. For the bottom, it looks like a triangle. Something like this</p><p><figure><a href=/blog/math-of-love/hearts1.jpg><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/hearts1_huf4d45962185a3638544c92554c3cc2e1_53164_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/hearts1_huf4d45962185a3638544c92554c3cc2e1_53164_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/hearts1_huf4d45962185a3638544c92554c3cc2e1_53164_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/hearts1_huf4d45962185a3638544c92554c3cc2e1_53164_1500x0_resize_q75_h2_box.webp><img alt="Hearts version 1" title="Hearts version 1" src=hearts1.jpg class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>So this is what my function signature looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// Draws a filled heart figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// x: horizontal position of the center of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// y: vertical position of the center of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// w: total width of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// overlap: overlap of the two circles in the top of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// tail: length of the triangle downwards
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> fillHeart(<span style=color:#66d9ef>uint8_t</span> x, <span style=color:#66d9ef>uint8_t</span> y, <span style=color:#66d9ef>uint8_t</span> w, <span style=color:#66d9ef>uint8_t</span> overlap, <span style=color:#66d9ef>uint8_t</span> tail, <span style=color:#66d9ef>uint16_t</span> color) 
</span></span></code></pre></div><p>Because i wasn’t sure how much the circles should overlap, i decided to make the amount of overlap a parameter in addition to the total width of the shape. I was also unsure how long the tail should be, so i also made that a parameter. So lets calculate the horizontal positions of the circles in relation to the center of the shape.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>//Let’s start by calculating the radius of the circle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>uint8_t</span> circleRadius <span style=color:#f92672>=</span> w <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> overlap <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>//Using that, we can calculate the distance from the center of the circle to the center of the heart shape.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>uint8_t</span> circleDistance <span style=color:#f92672>=</span> circleRadius <span style=color:#960050;background-color:#1e0010>—</span> overlap <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>//Now, we can draw two circles, one to the left and one to the right.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>tft.fillCircle(x <span style=color:#960050;background-color:#1e0010>—</span> circleDistance, y, circleRadius, color);
</span></span><span style=display:flex><span>tft.fillCircle(x <span style=color:#f92672>+</span> circleDistance, y, circleRadius, color);
</span></span><span style=display:flex><span><span style=color:#75715e>//Lastly, let’s get that triangle thing going!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>tft.fillTriangle(x <span style=color:#960050;background-color:#1e0010>—</span> w<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, y, x<span style=color:#f92672>+</span>, w<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, x, y <span style=color:#f92672>+</span> tail, color);
</span></span></code></pre></div><p>That worked! Great! Done? No! While tweaking with the parameters I came to the conclusion that my interpretation of a heart shape was just a little ‘off’. The straight line of the triangle doesn’t line up with the curved line of the circle. How do we fix this? by drawing the triangle lower. The ideal height seems to be the height of the lower intersection of the two circles.</p><p><figure><a href=/blog/math-of-love/hearts2.jpg><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/hearts2_hu4a1d94f06f7ca07605d93b6c17ae3b85_59178_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/hearts2_hu4a1d94f06f7ca07605d93b6c17ae3b85_59178_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/hearts2_hu4a1d94f06f7ca07605d93b6c17ae3b85_59178_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/hearts2_hu4a1d94f06f7ca07605d93b6c17ae3b85_59178_1500x0_resize_q75_h2_box.webp><img alt="Hearts 2.0" title="Hearts 2.0" src=hearts2.jpg class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>So how do we calculate the position of this intersection? Well, this is where our hero Pythagoras comes in. Let’s take a closer look at that left circle.</p><p><figure><a href=/blog/math-of-love/circle.jpg><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/circle_hu7fa07f3b53d28a43604a9cb1c17d3d80_86432_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/circle_hu7fa07f3b53d28a43604a9cb1c17d3d80_86432_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/circle_hu7fa07f3b53d28a43604a9cb1c17d3d80_86432_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/circle_hu7fa07f3b53d28a43604a9cb1c17d3d80_86432_1500x0_resize_q75_h2_box.webp><img alt="this is getting complicated" title="this is getting complicated" src=circle.jpg class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>So in this picture, h is the center of the heart shape, point c is the center of the left circle, and i is the point we want to find: where the two circles overlap. We know that i is directly below h, and point c is directly next to h, so h is a 90 degree angle. We want to know the length of side a. We know that side c is the radius of the circle, we calculated that already. We know that b is the radius minus some overlap, we also calculated that in variable circleDistance). So let’s do this thing highschool style:</p><p><figure><a href=/blog/math-of-love/highschool.jpg><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/highschool_hu0f27323f8aa519ff2039cf977a3e8cde_60521_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/highschool_hu0f27323f8aa519ff2039cf977a3e8cde_60521_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/highschool_hu0f27323f8aa519ff2039cf977a3e8cde_60521_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/highschool_hu0f27323f8aa519ff2039cf977a3e8cde_60521_1500x0_resize_q75_h2_box.webp><img alt="Remember these times?" title="Remember these times?" src=highschool.jpg class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>So here’s the full function in code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// Draws a filled heart figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// x: horizontal position of the center of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// y: vertical position of the center of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// w: total width of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// overlap: overlap of the two circles in the top of the figure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// tail: length of the triangle downwards
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fillHeart</span>(<span style=color:#66d9ef>uint8_t</span> x, <span style=color:#66d9ef>uint8_t</span> y, <span style=color:#66d9ef>uint8_t</span> w, <span style=color:#66d9ef>uint8_t</span> overlap, <span style=color:#66d9ef>uint8_t</span> tail, <span style=color:#66d9ef>uint16_t</span> color) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// calculate the radius of the circles using the total width and circle overlap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>uint8_t</span> circleRadius <span style=color:#f92672>=</span> w <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> overlap <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// calculate the distance of the centers of the circles to the center of the heart
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>uint8_t</span> circleDistance <span style=color:#f92672>=</span> circleRadius <span style=color:#f92672>-</span> overlap <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// left circle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  tft.fillCircle(x <span style=color:#f92672>-</span> circleDistance, y, circleRadius, color);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// right circle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  tft.fillCircle(x <span style=color:#f92672>+</span> circleDistance, y, circleRadius, color);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// calculate the y coordinate of the lower intersection point of the two circles
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>uint8_t</span> a <span style=color:#f92672>=</span> sqrt(sq(circleRadius) <span style=color:#f92672>-</span> sq(circleDistance) );
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>uint8_t</span> triangleY <span style=color:#f92672>=</span> y <span style=color:#f92672>+</span> a;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>uint8_t</span> triangleW <span style=color:#f92672>=</span> (circleRadius <span style=color:#f92672>-</span> (overlap<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// triangle pointing down
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  tft.fillTriangle(x <span style=color:#f92672>+</span> triangleW, triangleY, x <span style=color:#f92672>-</span> triangleW, triangleY, x, y <span style=color:#f92672>+</span> tail, color);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>When i use this in an animation, the framerate is still not great, you can see the circles being drawn before the triangle. But the effect looks cool, so i’m calling this a win for Pythagoras!</p><p>After fiddling with the parameters a little, i settled on setting the overlap to 0.1 times the total width, and the tail to 0.6 times the total width.</p><p><figure><a href=/blog/math-of-love/result.gif><picture><source media="(max-width: 376px)" srcset=/blog/math-of-love/result_hue6d65a6c5a704ed3eae3d8ca6bc68db3_2047700_500x0_resize_q75_h2_box.webp><source media="(max-width: 992px)" srcset=/blog/math-of-love/result_hue6d65a6c5a704ed3eae3d8ca6bc68db3_2047700_800x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/blog/math-of-love/result_hue6d65a6c5a704ed3eae3d8ca6bc68db3_2047700_1200x0_resize_q75_h2_box.webp><source media="(min-width: 1600px)" srcset=/blog/math-of-love/result_hue6d65a6c5a704ed3eae3d8ca6bc68db3_2047700_1500x0_resize_q75_h2_box.webp><img alt="Finally, some proper hearts!" title="Finally, some proper hearts!" src=result.gif class=img-fluid></picture></a><figcaption></figcaption></figure></p><p>Spread the love!</p></article></main><script async defer data-website-id=1c1c8489-4fb2-4940-af2a-09eca940adb1 src=https://analytics.clearsky.dev/umami.js></script></body></html>